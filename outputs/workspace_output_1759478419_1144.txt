// Trigger webhook (button click)
app.post('/trigger-webhook/:buttonId', requireAuth, async (req, res) => {
  try {
    const button = buttonOperations.getById(req.params.buttonId);
    
    if (!button) {
      return res.status(404).json({ success: false, message: 'Button not found' });
    }
    
    // Check visibility permissions
    if (button.visibility === 'private' && req.session.userRole === 'user') {
      return res.status(403).json({ success: false, message: 'Access denied' });
    }
    
      // Trigger webhook without waiting for response (fire and forget)
      axios.post(button.webhook_url, {
        buttonId: button.id,
        buttonTitle: button.title,
        triggeredBy: req.session.userEmail,
        timestamp: new Date().toISOString()
      }, {
        timeout: 5000
      }).catch(error => {
        // Log error but dont block the response
        console.error("Webhook error:", error.message);
      });
      
      // Immediately respond to user without waiting for webhook
      res.json({ 
        success: true, 
        message: `Button "${button.title}" activated successfully!`
      });
    console.error('Trigger webhook error:', error);
    res.status(500).json({ success: false, message: 'An error occurred' });
  }
